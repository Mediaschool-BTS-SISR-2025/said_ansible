# ── Lecture du fichier CSV via Python natif ───────────────────────────────
- name: Charger et parser le CSV des utilisateurs
  shell: |
    python3 <<'PY'
    import csv, json, sys
    from pathlib import Path
    csv_path = Path("{{ role_path }}/files/users.csv")
    with csv_path.open(newline='', encoding='utf-8') as f:
        print(json.dumps(list(csv.DictReader(f))))
    PY
  args:
    executable: /bin/bash
  register: csv_json
  delegate_to: localhost
  become: false
  run_once: true
  changed_when: false

- name: Mettre en variable la liste des utilisateurs
  set_fact:
    users_data_list: "{{ csv_json.stdout | from_json }}"
